<div class="dashboard-container">
  <!-- Header Compacto -->
  <div class="dashboard-header">
    <h1>üí∞ DivisasPro</h1>
    <p class="subtitle">Conversi√≥n de divisas en tiempo real</p>
  </div>

  <div class="content-wrapper">
    
    <!-- SECCI√ìN 1: CONVERSOR + RESULTADO (2 columnas) -->
    <div class="converter-section">
      <!-- Conversor (Izquierda) -->
      <mat-card class="converter-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>swap_horiz</mat-icon>
            Conversor
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <div class="conversion-form-compact">
            
            <!-- Cantidad (M√°s estrecha) -->
            <mat-form-field appearance="outline" class="amount-field-compact">
              <mat-label>Cantidad</mat-label>
              <input matInput 
                     type="number" 
                     [formControl]="cantidad"
                     placeholder="100">
            </mat-form-field>

            <!-- Fila de Divisas -->
            <div class="currency-row-compact">
              <mat-form-field appearance="outline" class="currency-field">
                <mat-label>De</mat-label>
                <mat-select [formControl]="monedaOrigen" (selectionChange)="onMonedaOrigenChange()">
                  <mat-option *ngFor="let divisa of getDivisasOrigen()" [value]="divisa.code">
                    {{divisa.flag}} {{divisa.code}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <button mat-icon-button 
                      color="primary" 
                      (click)="intercambiarDivisas()"
                      class="swap-button-compact">
                <mat-icon>swap_horiz</mat-icon>
              </button>

              <mat-form-field appearance="outline" class="currency-field">
                <mat-label>A</mat-label>
                <mat-select [formControl]="monedaDestino" (selectionChange)="onMonedaDestinoChange()">
                  <mat-option *ngFor="let divisa of getDivisasDestino()" [value]="divisa.code">
                    {{divisa.flag}} {{divisa.code}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Bot√≥n Convertir -->
            <button mat-raised-button 
                    color="primary" 
                    (click)="convert()"
                    class="convert-button-compact">
              <mat-icon>currency_exchange</mat-icon>
              Convertir
            </button>

          </div>
        </mat-card-content>
      </mat-card>

      <!-- Resultado (Derecha) - MEJORADA -->
      <mat-card class="result-card-improved" *ngIf="resultado">
        <mat-card-header>
          <mat-card-title>
            <mat-icon color="primary">currency_exchange</mat-icon>
            Resultado de Conversi√≥n
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <div class="result-display-improved">
            
            <!-- Resultado Principal - SIN SUPERPOSICI√ìN -->
            <div class="result-main-improved">
              <div class="conversion-summary">
                <span class="from-amount">{{ cantidad.value | number:'1.0-2' }} {{ monedaOrigen.value }}</span>
                <mat-icon class="equals-icon">trending_flat</mat-icon>
              </div>
              
              <div class="result-amount-improved">
                <div class="amount-display">
                  <span class="amount-number-big">{{ resultado.result | number:'1.2-4' }}</span>
                </div>
                <div class="currency-display">
                  <span class="currency-code-large">{{ monedaDestino.value }}</span>
                  <span class="currency-name-small">{{ getCurrencyFullName(monedaDestino.value!) }}</span>
                </div>
              </div>

              <!-- Tasa de Cambio Prominente -->
              <div class="exchange-rate-display">
                <div class="rate-box">
                  <mat-icon>info</mat-icon>
                  <span class="rate-text">1 {{ monedaOrigen.value }} = {{ resultado.rate | number:'1.4-4' }} {{ monedaDestino.value }}</span>
                </div>
              </div>
            </div>

            <!-- Stats en Grid 2x2 -->
            <div class="result-stats-grid">
              <div class="stat-box">
                <mat-icon class="stat-icon">calendar_today</mat-icon>
                <div class="stat-content">
                  <span class="stat-label">Fecha</span>
                  <span class="stat-value">{{ formatDate(resultado.date) }}</span>
                </div>
              </div>

              <div class="stat-box">
                <mat-icon class="stat-icon trending" [ngClass]="{
                  'trending-up': resultado.rate > 1,
                  'trending-down': resultado.rate < 1,
                  'trending-flat': resultado.rate === 1
                }">
                  {{ resultado.rate > 1 ? 'trending_up' : resultado.rate < 1 ? 'trending_down' : 'trending_flat' }}
                </mat-icon>
                <div class="stat-content">
                  <span class="stat-label">Fuerza</span>
                  <span class="stat-value" [ngClass]="{
                    'trend-strong': resultado.rate > 1,
                    'trend-weak': resultado.rate < 1,
                    'trend-equal': resultado.rate === 1
                  }">
                    {{ resultado.rate > 1 ? 'Fuerte' : resultado.rate < 1 ? 'D√©bil' : 'Equilibrado' }}
                  </span>
                </div>
              </div>

              <div class="stat-box">
                <mat-icon class="stat-icon">swap_horiz</mat-icon>
                <div class="stat-content">
                  <span class="stat-label">Inverso</span>
                  <span class="stat-value">1 {{ monedaDestino.value }} = {{ (1/resultado.rate) | number:'1.4-4' }} {{ monedaOrigen.value }}</span>
                </div>
              </div>

              <div class="stat-box">
                <mat-icon class="stat-icon">insights</mat-icon>
                <div class="stat-content">
                  <span class="stat-label">Volatilidad</span>
                  <span class="stat-value">{{ getVolatilityLevel(resultado.rate) }}</span>
                </div>
              </div>
            </div>

            <!-- Acciones Mejoradas -->
            <div class="result-actions-improved">
              <button mat-raised-button color="primary" (click)="intercambiarDivisas()">
                <mat-icon>swap_vert</mat-icon>
                Invertir Divisas
              </button>
              
              <button mat-stroked-button color="accent" (click)="copiarResultado()">
                <mat-icon>content_copy</mat-icon>
                Copiar
              </button>
              
              <button mat-stroked-button color="warn" (click)="compartirResultado()">
                <mat-icon>share</mat-icon>
                Compartir
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- SECCI√ìN 2: ANALYTICS (4 cards horizontales) -->
    <mat-card class="analytics-compact" *ngIf="userStats">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>analytics</mat-icon>
          Tus Estad√≠sticas
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="stats-grid-horizontal">
          <!-- Total Conversiones -->
          <div class="stat-card-compact conversions">
            <mat-icon>swap_horiz</mat-icon>
            <div class="stat-info">
              <span class="stat-number">{{ userStats.totalConversions }}</span>
              <span class="stat-label">Conversiones</span>
              <span class="stat-trend positive" *ngIf="userStats.weeklyTrend.includes('+')">{{ userStats.weeklyTrend }}</span>
            </div>
          </div>

          <!-- Volumen Total -->
          <div class="stat-card-compact volume">
            <mat-icon>attach_money</mat-icon>
            <div class="stat-info">
              <span class="stat-number">{{ formatVolume(userStats.totalVolume) }}</span>
              <span class="stat-label">Volumen</span>
            </div>
          </div>

          <!-- Par Favorito -->
          <div class="stat-card-compact pair">
            <mat-icon>favorite</mat-icon>
            <div class="stat-info">
              <span class="stat-number">{{ userStats.topPair }}</span>
              <span class="stat-label">Top Par</span>
            </div>
          </div>

          <!-- Total Alertas -->
          <div class="stat-card-compact alerts">
            <mat-icon>notifications</mat-icon>
            <div class="stat-info">
              <span class="stat-number">{{ userStats.totalAlerts }}</span>
              <span class="stat-label">Alertas</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- SECCI√ìN 3: TENDENCIAS FAVORITOS (Compacta) -->
    <mat-card class="trends-compact" *ngIf="favoriteTrends && favoriteTrends.trends && favoriteTrends.trends.length > 0">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>trending_up</mat-icon>
          Tendencias (7 d√≠as)
        </mat-card-title>
        <mat-card-subtitle>Tus pares favoritos</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="trends-horizontal">
          <div class="trend-item-compact" *ngFor="let trend of favoriteTrends.trends">
            <div class="trend-pair-compact">
              <span class="pair-name">{{ trend.pair }}</span>
              <span class="current-rate">{{ trend.currentRate }}</span>
            </div>
            
            <div class="trend-change-compact" [ngClass]="{
              'trend-up': trend.trend === 'up',
              'trend-down': trend.trend === 'down',
              'trend-stable': trend.trend === 'stable'
            }">
              <mat-icon *ngIf="trend.trend === 'up'">trending_up</mat-icon>
              <mat-icon *ngIf="trend.trend === 'down'">trending_down</mat-icon>
              <mat-icon *ngIf="trend.trend === 'stable'">trending_flat</mat-icon>
              {{ trend.change }}
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- SECCI√ìN 4: TIPOS DE CAMBIO MEJORADA -->
    <mat-card class="rates-section-improved">
      <mat-card-header>
        <div class="rates-header">
          <div class="rates-title">
            <mat-card-title>
              <mat-icon>trending_up</mat-icon>
              Mercado de Divisas
            </mat-card-title>
            <mat-card-subtitle>
              Base: {{ monedaBase.value }} ‚Ä¢ Actualizado {{ ultimaActualizacion }}
            </mat-card-subtitle>
          </div>
          
          <!-- Selector de Moneda Base -->
          <div class="base-currency-selector">
            <mat-form-field appearance="outline">
              <mat-label>Moneda Base</mat-label>
              <mat-select [formControl]="monedaBase" (selectionChange)="cambiarMonedaBase()">
                <mat-option *ngFor="let divisa of divisas" [value]="divisa.code">
                  {{ divisa.flag }} {{ divisa.code }} - {{ divisa.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </mat-card-header>

      <mat-card-content>
        <!-- Loading -->
        <div class="loading-rates" *ngIf="cargandoTabla">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Cargando tipos de cambio...</p>
        </div>

        <!-- Grid de Cards de Divisas -->
        <div class="rates-grid" *ngIf="!cargandoTabla && tiposCambio.length > 0">
          <div class="rate-card" 
               *ngFor="let rate of tiposCambio" 
               [ngClass]="{
                 'trending-up': getRandomTrend(rate.code) > 0,
                 'trending-down': getRandomTrend(rate.code) < 0,
                 'trending-stable': getRandomTrend(rate.code) === 0
               }">
            
            <!-- Header de la Card -->
            <div class="rate-header">
              <div class="currency-info">
                <span class="flag">{{ rate.flag }}</span>
                <div class="currency-details">
                  <strong class="currency-code">{{ rate.code }}</strong>
                  <small class="currency-name">{{ rate.name }}</small>
                </div>
              </div>
              
              <!-- Indicador de Tendencia -->
              <div class="trend-indicator" [ngClass]="{
                'trend-up': getRandomTrend(rate.code) > 0,
                'trend-down': getRandomTrend(rate.code) < 0,
                'trend-stable': getRandomTrend(rate.code) === 0
              }">
                <mat-icon *ngIf="getRandomTrend(rate.code) > 0">trending_up</mat-icon>
                <mat-icon *ngIf="getRandomTrend(rate.code) < 0">trending_down</mat-icon>
                <mat-icon *ngIf="getRandomTrend(rate.code) === 0">trending_flat</mat-icon>
              </div>
            </div>

            <!-- Tasa Principal -->
            <div class="rate-main">
              <span class="rate-value">{{ rate.rate | number:'1.2-6' }}</span>
              <span class="rate-label">{{ monedaBase.value }}/{{ rate.code }}</span>
            </div>

            <!-- Cambio y Porcentaje -->
            <div class="rate-change">
              <span class="change-percent" [ngClass]="{
                'positive': getRandomTrend(rate.code) > 0,
                'negative': getRandomTrend(rate.code) < 0,
                'neutral': getRandomTrend(rate.code) === 0
              }">
                {{ getRandomTrend(rate.code) > 0 ? '+' : '' }}{{ getRandomChangePercent(rate.code) }}%
              </span>
              <small class="change-label">vs ayer</small>
            </div>

            <!-- Informaci√≥n Adicional -->
            <div class="rate-extra">
              <div class="rate-stat">
                <mat-icon>swap_horiz</mat-icon>
                <span>1 {{ rate.code }} = {{ (1/rate.rate) | number:'1.2-6' }} {{ monedaBase.value }}</span>
              </div>
            </div>

            <!-- Acciones - Bot√≥n √önico -->
            <div class="rate-actions-single">
              <button mat-raised-button 
                      color="primary" 
                      (click)="convertirA(rate.code)"
                      class="convert-to-button">
                <mat-icon>currency_exchange</mat-icon>
                Convertir a {{ rate.code }}
              </button>
              
              <button mat-icon-button 
                      color="accent"
                      (click)="verDetalle(rate.code)"
                      matTooltip="Ver detalles">
                <mat-icon>info</mat-icon>
              </button> 
            </div>
          </div>
        </div>

        <!-- Estado Vac√≠o -->
        <div class="empty-rates" *ngIf="!cargandoTabla && tiposCambio.length === 0">
          <mat-icon>error_outline</mat-icon>
          <h3>No se pudieron cargar los tipos de cambio</h3>
          <p>Verifica tu conexi√≥n e int√©ntalo de nuevo</p>
          <button mat-raised-button color="primary" (click)="cargarTiposCambio()">
            <mat-icon>refresh</mat-icon>
            Reintentar
          </button>
        </div>
      </mat-card-content>
    </mat-card>

  </div>

  <!-- MODAL PARA DETALLES DE DIVISA -->
  <div class="currency-detail-modal" *ngIf="showCurrencyDetail" (click)="closeCurrencyModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <!-- Header del Modal -->
      <div class="modal-header">
        <div class="currency-header">
          <span class="currency-flag-large">{{ selectedCurrency?.flag }}</span>
          <div class="currency-title">
            <h2>{{ selectedCurrency?.name }}</h2>
            <span class="currency-code-subtitle">{{ selectedCurrency?.code }}</span>
          </div>
        </div>
        
        <button mat-icon-button (click)="closeCurrencyModal()" class="close-button">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Contenido del Modal -->
      <div class="modal-body">
        
        <!-- Informaci√≥n Principal -->
        <div class="currency-main-info">
          <div class="info-card primary">
            <mat-icon>trending_up</mat-icon>
            <div class="info-content">
              <span class="info-label">Tasa Actual</span>
              <span class="info-value">{{ selectedRate?.rate | number:'1.4-6' }}</span>
              <span class="info-description">1 {{ monedaBase.value }} = {{ selectedRate?.rate | number:'1.4-6' }} {{ selectedCurrency?.code }}</span>
            </div>
          </div>

          <div class="info-card secondary">
            <mat-icon>swap_horiz</mat-icon>
            <div class="info-content">
              <span class="info-label">Tasa Inversa</span>
              <span class="info-value">{{ getInverseRate() | number:'1.4-6' }}</span>
              <span class="info-description">1 {{ selectedCurrency?.code }} = {{ getInverseRate() | number:'1.4-6' }} {{ monedaBase.value }}</span>
            </div>
          </div>
        </div>

        <!-- An√°lisis y Tendencia -->
        <div class="currency-analysis">
          <div class="analysis-card">
            <div class="analysis-header">
              <mat-icon [ngClass]="{
                'trending-up': getTrendDirection() === 'up',
                'trending-down': getTrendDirection() === 'down',
                'trending-flat': getTrendDirection() === 'stable'
              }">
                {{ getTrendIcon() }}
              </mat-icon>
              <h3>An√°lisis T√©cnico</h3>
            </div>

            <div class="trend-info">
              <div class="trend-item">
                <span class="trend-label">Tendencia (7 d√≠as):</span>
                <span class="trend-value" [ngClass]="{
                  'positive': getTrendDirection() === 'up',
                  'negative': getTrendDirection() === 'down',
                  'neutral': getTrendDirection() === 'stable'
                }">
                  {{ getTrendDirection() === 'up' ? '+' : getTrendDirection() === 'down' ? '' : '' }}{{ getRandomChangePercent(selectedCurrency?.code || '') }}%
                </span>
              </div>

              <div class="trend-item">
                <span class="trend-label">Volatilidad:</span>
                <span class="trend-value">{{ getVolatilityLevel(selectedRate?.rate || 1) }}</span>
              </div>

              <div class="trend-item">
                <span class="trend-label">Fuerza:</span>
                <span class="trend-value" [ngClass]="{
                  'positive': (selectedRate?.rate || 1) > 1,
                  'negative': (selectedRate?.rate || 1) < 1,
                  'neutral': (selectedRate?.rate || 1) === 1
                }">
                  {{ (selectedRate?.rate || 1) > 1 ? 'Fuerte vs ' + monedaBase.value : (selectedRate?.rate || 1) < 1 ? 'D√©bil vs ' + monedaBase.value : 'Equilibrado' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- RECOMENDACI√ìN DE INVERSI√ìN -->
        <div class="investment-recommendation">
          <div class="recommendation-card" [ngClass]="{
            'bullish': getInvestmentRecommendation() === 'COMPRAR',
            'bearish': getInvestmentRecommendation() === 'VENDER',
            'neutral': getInvestmentRecommendation() === 'MANTENER'
          }">
            
            <div class="recommendation-header">
              <mat-icon>{{ getRecommendationIcon() }}</mat-icon>
              <h3>Recomendaci√≥n de Inversi√≥n</h3>
            </div>

            <div class="recommendation-content">
              <div class="recommendation-action">
                <span class="action-label">Acci√≥n Recomendada:</span>
                <span class="action-value">{{ getInvestmentRecommendation() }}</span>
              </div>

              <div class="recommendation-reason">
                <p><strong>An√°lisis:</strong> {{ getInvestmentReason() }}</p>
              </div>

              <div class="recommendation-confidence">
                <span class="confidence-label">Nivel de Confianza:</span>
                <div class="confidence-bar">
                  <div class="confidence-fill" [style.width.%]="getConfidenceLevel()"></div>
                </div>
                <span class="confidence-value">{{ getConfidenceLevel() }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones del Modal -->
      <div class="modal-actions">
        <button mat-raised-button color="primary" (click)="convertirA(selectedCurrency?.code || '')">
          <mat-icon>currency_exchange</mat-icon>
          Convertir a {{ selectedCurrency?.code }}
        </button>
        
        <button mat-stroked-button color="accent" (click)="addToFavorites()">
          <mat-icon>favorite_border</mat-icon>
          A√±adir a Favoritos
        </button>
        
        <button mat-stroked-button (click)="closeCurrencyModal()">
          <mat-icon>close</mat-icon>
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
