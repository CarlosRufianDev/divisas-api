<div class="calculator-container">
  <div class="content-wrapper">
    <!-- ============================================================================ -->
    <!-- 游늶 HEADER SIMPLIFICADO PARA CALCULADORA M칔LTIPLE -->
    <!-- ============================================================================ -->
    <div class="calculator-header">
      <div class="header-content">
        <div class="header-info">
          <div class="header-text">
            <h1>Calculadora M칰ltiple</h1>
            <p>Convierte una cantidad a m칰ltiples divisas simult치neamente</p>
          </div>
        </div>
        <div class="header-stats" *ngIf="results && results.conversions.length > 0">
          <div class="stat-item">
            <span class="stat-number">{{ results.conversions.length }}</span>
            <span class="stat-label">Conversiones</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ results.baseAmount | number:'1.0-0' }}</span>
            <span class="stat-label">{{ results.baseCurrency }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================================================ -->
    <!-- 游빑 FORMULARIO DE CALCULADORA M칔LTIPLE -->
    <!-- ============================================================================ -->
    <mat-card class="calculator-form-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>calculate</mat-icon>
          Configuraci칩n de Conversi칩n
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="calculatorForm" class="calculator-form">
          <!-- Cantidad a convertir -->
          <mat-form-field appearance="outline" class="amount-field">
            <mat-label>Cantidad</mat-label>
            <input
              matInput
              type="number"
              formControlName="amount"
              placeholder="Ingresa la cantidad"
            />
            <mat-icon matSuffix>attach_money</mat-icon>
          </mat-form-field>

          <!-- Moneda origen -->
          <mat-form-field appearance="outline" class="from-currency-field">
            <mat-label>Moneda Origen</mat-label>
            <mat-select formControlName="from">
              <mat-option *ngFor="let currency of availableCurrencies" [value]="currency.code">
                {{ currency.flag }} {{ currency.code }} - {{ currency.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Monedas destino (m칰ltiple selecci칩n) -->
          <mat-form-field appearance="outline" class="target-currencies-field">
            <mat-label>Monedas Destino</mat-label>
            <mat-select formControlName="targetCurrencies" multiple>
              <mat-option *ngFor="let currency of getFilteredCurrencies()" [value]="currency.code">
                {{ currency.flag }} {{ currency.code }} - {{ currency.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Selecciona m칰ltiples monedas para convertir</mat-hint>
          </mat-form-field>

          <!-- Botones de acci칩n -->
          <div class="form-actions">
            <button
              mat-raised-button
              color="primary"
              type="button"
              (click)="calculateMultiple()"
              [disabled]="loading || calculatorForm.invalid"
              class="calculate-btn"
            >
              <mat-icon>calculate</mat-icon>
              {{ loading ? 'Calculando...' : 'Calcular Conversiones' }}
            </button>
            
            <button
              mat-stroked-button
              type="button"
              (click)="clearResults()"
              [disabled]="loading"
              class="clear-btn"
            >
              <mat-icon>clear</mat-icon>
              Limpiar
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- ============================================================================ -->
    <!-- 游늵 RESULTADOS DE LA CALCULADORA M칔LTIPLE -->
    <!-- ============================================================================ -->
    <mat-card 
      class="results-section"
      *ngIf="!loading && results && results.conversions.length > 0"
    >
      <mat-card-header>
        <mat-card-title>
          <mat-icon>trending_up</mat-icon>
          Resultados ({{ results.conversions.length }} conversiones)
        </mat-card-title>
        <button
          mat-raised-button
          class="export-btn"
          (click)="exportResults()"
        >
          <mat-icon>download</mat-icon>
          Exportar
        </button>
      </mat-card-header>

      <mat-card-content>
        <!-- Resumen de conversi칩n -->
        <div class="conversion-summary">
          <div class="summary-info">
            <span class="base-amount">{{ results.baseAmount | number:'1.2-2' }} {{ results.baseCurrency }}</span>
            <mat-icon>arrow_forward</mat-icon>
            <span class="target-count">{{ results.conversions.length }} divisas</span>
          </div>
          <div class="timestamp">
            <small>{{ results.timestamp | date:'medium':'es-ES' }}</small>
          </div>
        </div>

        <!-- Grid de resultados -->
        <div class="results-grid">
          <div
            *ngFor="let conversion of results.conversions; trackBy: trackByConversion"
            class="result-card"
          >
            <!-- Header de la conversi칩n -->
            <div class="conversion-header">
              <div class="currency-info">
                <span class="currency-flag">{{ getCurrencyFlag(conversion.to) }}</span>
                <span class="currency-code">{{ conversion.to }}</span>
              </div>
              <div class="currency-name">{{ getCurrencyName(conversion.to) }}</div>
            </div>

            <!-- Resultado principal -->
            <div class="conversion-result">
              <div class="converted-amount">{{ conversion.result | number:'1.2-2' }}</div>
              <div class="exchange-rate">
                1 {{ conversion.from }} = {{ conversion.rate | number:'1.4-4' }} {{ conversion.to }}
              </div>
            </div>

            <!-- Acciones -->
            <div class="conversion-actions">
              <button
                mat-icon-button
                (click)="copyToClipboard(conversion)"
                matTooltip="Copiar resultado"
              >
                <mat-icon>content_copy</mat-icon>
              </button>
              
              <button
                mat-icon-button
                (click)="addToFavorites(conversion)"
                matTooltip="A침adir a favoritos"
              >
                <mat-icon>star_border</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Acciones de resultados -->
        <div class="results-actions">
          <button
            mat-raised-button
            color="accent"
            (click)="shareResults()"
          >
            <mat-icon>share</mat-icon>
            Compartir
          </button>

          <button 
            mat-raised-button 
            color="primary" 
            (click)="recalculate()"
          >
            <mat-icon>refresh</mat-icon>
            Recalcular
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- ============================================================================ -->
    <!-- 游뛂 ESTADO VAC칈O -->
    <!-- ============================================================================ -->
    <mat-card
      *ngIf="!loading && (!results || results.conversions.length === 0)"
      class="empty-state"
    >
      <mat-card-content>
        <div class="no-data-message">
          <mat-icon class="no-data-icon">calculate</mat-icon>
          <h3>Calculadora Lista</h3>
          <p>Configura tu conversi칩n m칰ltiple y obt칠n resultados instant치neos</p>
          <button
            mat-raised-button
            color="primary"
            (click)="calculateMultiple()"
            [disabled]="calculatorForm.invalid"
          >
            <mat-icon>calculate</mat-icon>
            Calcular Ahora
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Loading indicator -->
    <mat-card *ngIf="loading" class="loading-card">
      <mat-card-content>
        <div class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Calculando conversiones m칰ltiples...</p>
        </div>
      </mat-card-content>
    </mat-card>

  </div>
</div>
